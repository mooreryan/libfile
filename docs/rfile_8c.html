<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ruby-like C: src/rfile.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Ruby-like C
   &#160;<span id="projectnumber">v0.1.0</span>
   </div>
   <div id="projectbrief">Provides common file and path manipulating functions.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">rfile.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>File containing functions like those found in Ruby's File class.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;assert.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;sys/stat.h&gt;</code><br />
<code>#include &quot;rfile.h&quot;</code><br />
<code>#include &quot;err_codes.h&quot;</code><br />
<code>#include &quot;bstrlib.h&quot;</code><br />
</div>
<p><a href="rfile_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a54eb85ea81a2606c840a63ee89f0bf0a"><td class="memItemLeft" align="right" valign="top"><a id="a54eb85ea81a2606c840a63ee89f0bf0a"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>index_before_first_trailing_file_separator</b> (const rstring *fname)</td></tr>
<tr class="separator:a54eb85ea81a2606c840a63ee89f0bf0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a496d9e0e8d3dd7c8f1b763e1e5a06f"><td class="memItemLeft" align="right" valign="top"><a id="a7a496d9e0e8d3dd7c8f1b763e1e5a06f"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>index_of_last_file_separator_from_pos</b> (const rstring *fname, int pos)</td></tr>
<tr class="separator:a7a496d9e0e8d3dd7c8f1b763e1e5a06f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03480d668cd2de8237b1a5eb5c92e9f8"><td class="memItemLeft" align="right" valign="top"><a id="a03480d668cd2de8237b1a5eb5c92e9f8"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>index_of_last_file_separator</b> (const rstring *fname)</td></tr>
<tr class="separator:a03480d668cd2de8237b1a5eb5c92e9f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f8f09ed81e27bb5fd0a8d5f12108bcf"><td class="memItemLeft" align="right" valign="top"><a id="a9f8f09ed81e27bb5fd0a8d5f12108bcf"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rfile_8c.html#a9f8f09ed81e27bb5fd0a8d5f12108bcf">rfile_exist</a> (const rstring *fname)</td></tr>
<tr class="memdesc:a9f8f09ed81e27bb5fd0a8d5f12108bcf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tells whether a file exists or not (i.e., stat is successful). <br /></td></tr>
<tr class="separator:a9f8f09ed81e27bb5fd0a8d5f12108bcf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a25e5f63b8902baf642dd2642160e44"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rfile_8c.html#a9a25e5f63b8902baf642dd2642160e44">rfile_is_directory</a> (const rstring *fname)</td></tr>
<tr class="memdesc:a9a25e5f63b8902baf642dd2642160e44"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns true if the named file is a directory, and false otherwise.  <a href="#a9a25e5f63b8902baf642dd2642160e44">More...</a><br /></td></tr>
<tr class="separator:a9a25e5f63b8902baf642dd2642160e44"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac7f023436f8dab5020f08fe31684b7f7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rfile_8c.html#ac7f023436f8dab5020f08fe31684b7f7">rfile_is_file</a> (const rstring *fname)</td></tr>
<tr class="memdesc:ac7f023436f8dab5020f08fe31684b7f7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns true if the named file exists and is a regular file, and false otherwise.  <a href="#ac7f023436f8dab5020f08fe31684b7f7">More...</a><br /></td></tr>
<tr class="separator:ac7f023436f8dab5020f08fe31684b7f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adeabc016ec0c86ad397565af546391e1"><td class="memItemLeft" align="right" valign="top">rstring *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rfile_8c.html#adeabc016ec0c86ad397565af546391e1">rfile_basename</a> (const rstring *fname)</td></tr>
<tr class="memdesc:adeabc016ec0c86ad397565af546391e1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the basename of a file.  <a href="#adeabc016ec0c86ad397565af546391e1">More...</a><br /></td></tr>
<tr class="separator:adeabc016ec0c86ad397565af546391e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c0183d77333551e1a7d87af8bffacaf"><td class="memItemLeft" align="right" valign="top">rstring *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rfile_8c.html#a0c0183d77333551e1a7d87af8bffacaf">rfile_dirname</a> (const rstring *fname)</td></tr>
<tr class="memdesc:a0c0183d77333551e1a7d87af8bffacaf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the dirname of a file.  <a href="#a0c0183d77333551e1a7d87af8bffacaf">More...</a><br /></td></tr>
<tr class="separator:a0c0183d77333551e1a7d87af8bffacaf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7d8d56ccb773cd58095cc5b706ee542f"><td class="memItemLeft" align="right" valign="top">rstring *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rfile_8c.html#a7d8d56ccb773cd58095cc5b706ee542f">rfile_extname</a> (const rstring *fname)</td></tr>
<tr class="memdesc:a7d8d56ccb773cd58095cc5b706ee542f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the extension of a file.  <a href="#a7d8d56ccb773cd58095cc5b706ee542f">More...</a><br /></td></tr>
<tr class="separator:a7d8d56ccb773cd58095cc5b706ee542f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1dcfb5d7db6ca3365e74df214c5ffdae"><td class="memItemLeft" align="right" valign="top">rstring *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rfile_8c.html#a1dcfb5d7db6ca3365e74df214c5ffdae">rfile_join</a> (rstring_array *rary)</td></tr>
<tr class="memdesc:a1dcfb5d7db6ca3365e74df214c5ffdae"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns a new path by joining the strings using the RFILE_SEPARATOR.  <a href="#a1dcfb5d7db6ca3365e74df214c5ffdae">More...</a><br /></td></tr>
<tr class="separator:a1dcfb5d7db6ca3365e74df214c5ffdae"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>File containing functions like those found in Ruby's File class. </p>
<dl class="section author"><dt>Author</dt><dd>Ryan Moore </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a href="https://ruby-doc.org/core-2.5.0/File.html">https://ruby-doc.org/core-2.5.0/File.html</a> </dd></dl>

<p class="definition">Definition in file <a class="el" href="rfile_8c_source.html">rfile.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="adeabc016ec0c86ad397565af546391e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adeabc016ec0c86ad397565af546391e1">&#9670;&nbsp;</a></span>rfile_basename()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rstring* rfile_basename </td>
          <td>(</td>
          <td class="paramtype">const rstring *&#160;</td>
          <td class="paramname"><em>fname</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the basename of a file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fname</td><td>The file name or the path. NULL is returned if param is NULL. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The basename of the file or path or NULL if there were errors.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>The caller must free the return value. </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>The caller must check the return value for NULL.</dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000003">Todo:</a></b></dt><dd>Ruby's also takes an optional second param for extname to strip. </dd></dl>

<p class="definition">Definition at line <a class="el" href="rfile_8c_source.html#l00166">166</a> of file <a class="el" href="rfile_8c_source.html">rfile.c</a>.</p>

<p class="reference">References <a class="el" href="rstring_8c_source.html#l00267">rstring_length()</a>, and <a class="el" href="rstring_8c_source.html#l00028">rstring_new()</a>.</p>
<div class="fragment"><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;{</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keywordflow">if</span> (fname == NULL) { <span class="keywordflow">return</span> NULL; }</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="keywordtype">int</span> i                = 0;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="keywordtype">int</span> i_last_fs        = 0;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="keywordtype">int</span> i_basename_start = 0;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="keywordtype">int</span> slen         = <a class="code" href="rstring_8c.html#a48e81cf18a8972237e862c8ac8c160f7">rstring_length</a>(fname);</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="keywordflow">if</span> (slen == RERROR) { <span class="keywordflow">return</span> NULL; }</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="keywordtype">int</span> basename_len = 0;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  rstring* basename = NULL;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="comment">/* If we are passed an empty string.... */</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="keywordflow">if</span> (slen == 0) {</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    basename = <a class="code" href="rstring_8c.html#af5be360e4bfbee194994cd2ddc3a6823">rstring_new</a>(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordflow">if</span> (basename == NULL) { <span class="keywordflow">return</span> NULL; }</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordflow">return</span> basename;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  }</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  i = index_before_first_trailing_file_separator(fname);</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <span class="keywordflow">if</span> (i &lt; 0) {</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment">/* This can only happen for names like &quot;////&quot; */</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="rstring_8c.html#a7162fcaec08cf423ad11dfecc279499e">rstring_char_at</a>(fname, 0) != RFILE_SEPARATOR) {</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    }</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    basename = <a class="code" href="rstring_8c.html#af5be360e4bfbee194994cd2ddc3a6823">rstring_new</a>(RFILE_SEPARATOR_STR);</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordflow">if</span> (basename == NULL) { <span class="keywordflow">return</span> NULL; }</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  }</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="comment">/* The current index points to the char just before the first of</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">       trailing RFILE_SEPARATOR chars if there are any, so the trailing</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">       RFILE_SEPARATORs begin at i + 1. */</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    i_last_fs = i + 1;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordflow">for</span> (i = i_last_fs - 1; i &gt;= 0; --i) {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="rstring_8c.html#a7162fcaec08cf423ad11dfecc279499e">rstring_char_at</a>(fname, i) == RFILE_SEPARATOR) {</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      }</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    }</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    i_basename_start = i + 1;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    basename_len     = i_last_fs - i_basename_start;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    basename = <a class="code" href="rstring_8c.html#aca8c55710516d18aa8c143c51a546049">rstring_slice</a>(fname, i_basename_start, basename_len);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keywordflow">if</span> (basename == NULL) { <span class="keywordflow">return</span> NULL; }</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  }</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="keywordflow">return</span> basename;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;}</div><div class="ttc" id="rstring_8c_html_aca8c55710516d18aa8c143c51a546049"><div class="ttname"><a href="rstring_8c.html#aca8c55710516d18aa8c143c51a546049">rstring_slice</a></div><div class="ttdeci">rstring * rstring_slice(const rstring *rstr, int index, int length)</div><div class="ttdoc">Return a substring starting at index of a given length (clamped by the end of rstr). </div><div class="ttdef"><b>Definition:</b> <a href="rstring_8c_source.html#l00177">rstring.c:177</a></div></div>
<div class="ttc" id="rstring_8c_html_a7162fcaec08cf423ad11dfecc279499e"><div class="ttname"><a href="rstring_8c.html#a7162fcaec08cf423ad11dfecc279499e">rstring_char_at</a></div><div class="ttdeci">int rstring_char_at(const rstring *rstr, int idx)</div><div class="ttdoc">Return the char at given position. </div><div class="ttdef"><b>Definition:</b> <a href="rstring_8c_source.html#l00290">rstring.c:290</a></div></div>
<div class="ttc" id="rstring_8c_html_af5be360e4bfbee194994cd2ddc3a6823"><div class="ttname"><a href="rstring_8c.html#af5be360e4bfbee194994cd2ddc3a6823">rstring_new</a></div><div class="ttdeci">rstring * rstring_new(const char *cstr)</div><div class="ttdoc">Make a new rstring from c string. </div><div class="ttdef"><b>Definition:</b> <a href="rstring_8c_source.html#l00028">rstring.c:28</a></div></div>
<div class="ttc" id="rstring_8c_html_a48e81cf18a8972237e862c8ac8c160f7"><div class="ttname"><a href="rstring_8c.html#a48e81cf18a8972237e862c8ac8c160f7">rstring_length</a></div><div class="ttdeci">int rstring_length(const rstring *rstr)</div><div class="ttdoc">Returns the length of the rstring. </div><div class="ttdef"><b>Definition:</b> <a href="rstring_8c_source.html#l00267">rstring.c:267</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0c0183d77333551e1a7d87af8bffacaf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0c0183d77333551e1a7d87af8bffacaf">&#9670;&nbsp;</a></span>rfile_dirname()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rstring* rfile_dirname </td>
          <td>(</td>
          <td class="paramtype">const rstring *&#160;</td>
          <td class="paramname"><em>fname</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the dirname of a file. </p>
<p>Returns all components of the filename given in file_name except the last one (after first stripping trailing separators).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fname</td><td>The file name or the path. NULL is returned if param is NULL. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The dirname of the file or path or NULL if there were errors.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>The caller must free the return value. </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>The caller must check the return value for NULL. </dd></dl>

<p class="definition">Definition at line <a class="el" href="rfile_8c_source.html#l00235">235</a> of file <a class="el" href="rfile_8c_source.html">rfile.c</a>.</p>

<p class="reference">References <a class="el" href="rstring_8c_source.html#l00267">rstring_length()</a>, and <a class="el" href="rstring_8c_source.html#l00028">rstring_new()</a>.</p>
<div class="fragment"><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;{</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keywordflow">if</span> (fname == NULL) { <span class="keywordflow">return</span> NULL; }</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="keywordtype">int</span> i = 0;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="keywordtype">int</span> slen = <a class="code" href="rstring_8c.html#a48e81cf18a8972237e862c8ac8c160f7">rstring_length</a>(fname);</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  rstring* dirname = NULL;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="keywordflow">if</span> (slen == 0) {</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    dirname = <a class="code" href="rstring_8c.html#af5be360e4bfbee194994cd2ddc3a6823">rstring_new</a>(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">return</span> dirname;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  }</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  i = index_of_last_file_separator(fname);</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <span class="keywordflow">if</span> (i &lt; 0 &amp;&amp; <a class="code" href="rstring_8c.html#a7162fcaec08cf423ad11dfecc279499e">rstring_char_at</a>(fname, 0) == RFILE_SEPARATOR) {</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="comment">/* Filenames like: &quot;/////&quot; */</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    dirname = <a class="code" href="rstring_8c.html#af5be360e4bfbee194994cd2ddc3a6823">rstring_new</a>(RFILE_SEPARATOR_STR);</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  }</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i &lt; 0) {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="comment">/* Filenames like: &quot;apple&quot; */</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    dirname = <a class="code" href="rstring_8c.html#af5be360e4bfbee194994cd2ddc3a6823">rstring_new</a>(<span class="stringliteral">&quot;.&quot;</span>);</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="comment">/* There was a basename.  Now we need to make sure that there</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">       aren&#39;t a bunch of fs chars right in a row. */</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    i = index_of_last_file_separator_from_pos(fname, i);</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">if</span> (i &lt;= 0) {</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      <span class="comment">/* This could happen for filenames like: &quot;/////apple&quot; or &quot;/apple&quot; */</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      dirname = <a class="code" href="rstring_8c.html#af5be360e4bfbee194994cd2ddc3a6823">rstring_new</a>(RFILE_SEPARATOR_STR);</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    }</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      <span class="keywordtype">int</span> i_before_last_fs = i - 1;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      dirname = <a class="code" href="rstring_8c.html#aca8c55710516d18aa8c143c51a546049">rstring_slice</a>(fname, 0, i_before_last_fs + 1);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    }</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  }</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <span class="keywordflow">return</span> dirname;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;}</div><div class="ttc" id="rstring_8c_html_aca8c55710516d18aa8c143c51a546049"><div class="ttname"><a href="rstring_8c.html#aca8c55710516d18aa8c143c51a546049">rstring_slice</a></div><div class="ttdeci">rstring * rstring_slice(const rstring *rstr, int index, int length)</div><div class="ttdoc">Return a substring starting at index of a given length (clamped by the end of rstr). </div><div class="ttdef"><b>Definition:</b> <a href="rstring_8c_source.html#l00177">rstring.c:177</a></div></div>
<div class="ttc" id="rstring_8c_html_a7162fcaec08cf423ad11dfecc279499e"><div class="ttname"><a href="rstring_8c.html#a7162fcaec08cf423ad11dfecc279499e">rstring_char_at</a></div><div class="ttdeci">int rstring_char_at(const rstring *rstr, int idx)</div><div class="ttdoc">Return the char at given position. </div><div class="ttdef"><b>Definition:</b> <a href="rstring_8c_source.html#l00290">rstring.c:290</a></div></div>
<div class="ttc" id="rstring_8c_html_af5be360e4bfbee194994cd2ddc3a6823"><div class="ttname"><a href="rstring_8c.html#af5be360e4bfbee194994cd2ddc3a6823">rstring_new</a></div><div class="ttdeci">rstring * rstring_new(const char *cstr)</div><div class="ttdoc">Make a new rstring from c string. </div><div class="ttdef"><b>Definition:</b> <a href="rstring_8c_source.html#l00028">rstring.c:28</a></div></div>
<div class="ttc" id="rstring_8c_html_a48e81cf18a8972237e862c8ac8c160f7"><div class="ttname"><a href="rstring_8c.html#a48e81cf18a8972237e862c8ac8c160f7">rstring_length</a></div><div class="ttdeci">int rstring_length(const rstring *rstr)</div><div class="ttdoc">Returns the length of the rstring. </div><div class="ttdef"><b>Definition:</b> <a href="rstring_8c_source.html#l00267">rstring.c:267</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7d8d56ccb773cd58095cc5b706ee542f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7d8d56ccb773cd58095cc5b706ee542f">&#9670;&nbsp;</a></span>rfile_extname()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rstring* rfile_extname </td>
          <td>(</td>
          <td class="paramtype">const rstring *&#160;</td>
          <td class="paramname"><em>fname</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the extension of a file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fname</td><td>The file name or the path. NULL is returned if param is NULL. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The extension of the file or path or NULL if there were errors.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>The caller must free the return value. </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>The caller must check the return value for NULL. </dd></dl>

<p class="definition">Definition at line <a class="el" href="rfile_8c_source.html#l00290">290</a> of file <a class="el" href="rfile_8c_source.html">rfile.c</a>.</p>

<p class="reference">References <a class="el" href="rfile_8c_source.html#l00166">rfile_basename()</a>, <a class="el" href="rstring_8c_source.html#l00066">rstring_free()</a>, <a class="el" href="rstring_8c_source.html#l00267">rstring_length()</a>, <a class="el" href="rstring_8c_source.html#l00028">rstring_new()</a>, and <a class="el" href="rstring_8c_source.html#l00177">rstring_slice()</a>.</p>
<div class="fragment"><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;{</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="keywordflow">if</span> (fname == NULL) { <span class="keywordflow">return</span> NULL; }</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="keywordtype">int</span> basename_len = 0;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="keywordtype">int</span> last_dot = 0;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  rstring* basename = NULL;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  rstring* extname  = NULL;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  basename     = <a class="code" href="rfile_8c.html#adeabc016ec0c86ad397565af546391e1">rfile_basename</a>(fname);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <span class="keywordflow">if</span> (basename == NULL) { <span class="keywordflow">return</span> NULL; }</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  basename_len = <a class="code" href="rstring_8c.html#a48e81cf18a8972237e862c8ac8c160f7">rstring_length</a>(basename);</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  last_dot = bstrrchr((const_bstring)basename, <span class="charliteral">&#39;.&#39;</span>);</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="keywordflow">if</span> (<span class="comment">/* No &#39;.&#39; was found */</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      (last_dot == BSTR_ERR) ||</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <span class="comment">/* The last dot was the first char: &quot;.profile&quot; */</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      (last_dot == 0) ||</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      <span class="comment">/* If the dot was the last thing in the fname: &quot;foo.&quot; */</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      (last_dot == basename_len - 1)) {</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    extname = <a class="code" href="rstring_8c.html#af5be360e4bfbee194994cd2ddc3a6823">rstring_new</a>(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">if</span> (extname == NULL) { <span class="keywordflow">return</span> NULL; }</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  }</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    extname = <a class="code" href="rstring_8c.html#aca8c55710516d18aa8c143c51a546049">rstring_slice</a>(basename, last_dot, basename_len);</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="keywordflow">if</span> (extname == NULL) { <span class="keywordflow">return</span> NULL; }</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  }</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <a class="code" href="rstring_8c.html#adc92beb556cd031893d12de377ab1b48">rstring_free</a>(basename);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="keywordflow">return</span> extname;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;}</div><div class="ttc" id="rstring_8c_html_aca8c55710516d18aa8c143c51a546049"><div class="ttname"><a href="rstring_8c.html#aca8c55710516d18aa8c143c51a546049">rstring_slice</a></div><div class="ttdeci">rstring * rstring_slice(const rstring *rstr, int index, int length)</div><div class="ttdoc">Return a substring starting at index of a given length (clamped by the end of rstr). </div><div class="ttdef"><b>Definition:</b> <a href="rstring_8c_source.html#l00177">rstring.c:177</a></div></div>
<div class="ttc" id="rfile_8c_html_adeabc016ec0c86ad397565af546391e1"><div class="ttname"><a href="rfile_8c.html#adeabc016ec0c86ad397565af546391e1">rfile_basename</a></div><div class="ttdeci">rstring * rfile_basename(const rstring *fname)</div><div class="ttdoc">Return the basename of a file. </div><div class="ttdef"><b>Definition:</b> <a href="rfile_8c_source.html#l00166">rfile.c:166</a></div></div>
<div class="ttc" id="rstring_8c_html_af5be360e4bfbee194994cd2ddc3a6823"><div class="ttname"><a href="rstring_8c.html#af5be360e4bfbee194994cd2ddc3a6823">rstring_new</a></div><div class="ttdeci">rstring * rstring_new(const char *cstr)</div><div class="ttdoc">Make a new rstring from c string. </div><div class="ttdef"><b>Definition:</b> <a href="rstring_8c_source.html#l00028">rstring.c:28</a></div></div>
<div class="ttc" id="rstring_8c_html_adc92beb556cd031893d12de377ab1b48"><div class="ttname"><a href="rstring_8c.html#adc92beb556cd031893d12de377ab1b48">rstring_free</a></div><div class="ttdeci">int rstring_free(rstring *rstr)</div><div class="ttdoc">Free the rstring. </div><div class="ttdef"><b>Definition:</b> <a href="rstring_8c_source.html#l00066">rstring.c:66</a></div></div>
<div class="ttc" id="rstring_8c_html_a48e81cf18a8972237e862c8ac8c160f7"><div class="ttname"><a href="rstring_8c.html#a48e81cf18a8972237e862c8ac8c160f7">rstring_length</a></div><div class="ttdeci">int rstring_length(const rstring *rstr)</div><div class="ttdoc">Returns the length of the rstring. </div><div class="ttdef"><b>Definition:</b> <a href="rstring_8c_source.html#l00267">rstring.c:267</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9a25e5f63b8902baf642dd2642160e44"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9a25e5f63b8902baf642dd2642160e44">&#9670;&nbsp;</a></span>rfile_is_directory()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rfile_is_directory </td>
          <td>(</td>
          <td class="paramtype">const rstring *&#160;</td>
          <td class="paramname"><em>fname</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns true if the named file is a directory, and false otherwise. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fname</td><td>The file name or the path. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>RTRUE if fname is a directory, RFALSE if not, RERROR if errors occured.</dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>Ruby also returns true if fname is a symlink that points at a directory. </dd></dl>

<p class="definition">Definition at line <a class="el" href="rfile_8c_source.html#l00099">99</a> of file <a class="el" href="rfile_8c_source.html">rfile.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;{</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="keywordflow">if</span> (fname == NULL) { <span class="keywordflow">return</span> RERROR; }</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="keywordtype">int</span> ret_val = 0;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="keywordtype">char</span>* cfname = bstr2cstr(fname, <span class="charliteral">&#39;?&#39;</span>);</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="keywordflow">if</span> (cfname == NULL) { <span class="keywordflow">return</span> RERROR; }</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="keyword">struct </span>stat st;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  ret_val = stat(cfname, &amp;st);</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  bcstrfree(cfname);</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="keywordflow">if</span> (ret_val &lt; 0 || !S_ISDIR(st.st_mode)) {</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keywordflow">return</span> RFALSE;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  }</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keywordflow">return</span> RTRUE;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  }</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="ac7f023436f8dab5020f08fe31684b7f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac7f023436f8dab5020f08fe31684b7f7">&#9670;&nbsp;</a></span>rfile_is_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rfile_is_file </td>
          <td>(</td>
          <td class="paramtype">const rstring *&#160;</td>
          <td class="paramname"><em>fname</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns true if the named file exists and is a regular file, and false otherwise. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fname</td><td>The file name or the path. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True if file exists and is regular file. If the fname was NULL, 0 is returned.</dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000002">Todo:</a></b></dt><dd>Ruby also returns true if fname is a symlink that points at a file. </dd></dl>

<p class="definition">Definition at line <a class="el" href="rfile_8c_source.html#l00131">131</a> of file <a class="el" href="rfile_8c_source.html">rfile.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;{</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="keywordflow">if</span> (fname == NULL) { <span class="keywordflow">return</span> RERROR; }</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="keywordtype">int</span> ret_val = 0;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="keywordtype">char</span>* cfname = bstr2cstr(fname, <span class="charliteral">&#39;?&#39;</span>);</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keywordflow">if</span> (cfname == NULL) { <span class="keywordflow">return</span> RERROR; }</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="keyword">struct </span>stat st;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  ret_val = stat(cfname, &amp;st);</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  bcstrfree(cfname);</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keywordflow">if</span> (ret_val &lt; 0 || !S_ISREG(st.st_mode)) {</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordflow">return</span> RFALSE;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  }</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">return</span> RTRUE;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  }</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a1dcfb5d7db6ca3365e74df214c5ffdae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1dcfb5d7db6ca3365e74df214c5ffdae">&#9670;&nbsp;</a></span>rfile_join()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rstring* rfile_join </td>
          <td>(</td>
          <td class="paramtype">rstring_array *&#160;</td>
          <td class="paramname"><em>rary</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns a new path by joining the strings using the RFILE_SEPARATOR. </p>
<div class="fragment"><div class="line"><span class="keywordtype">char</span>* actual = NULL;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* strings1[3] = { <span class="stringliteral">&quot;apple&quot;</span>, <span class="stringliteral">&quot;pie&quot;</span>, <span class="stringliteral">&quot;good&quot;</span> };</div><div class="line"></div><div class="line">TEST_ASSERT_EQUAL_STRING(<span class="stringliteral">&quot;apple/pie/good&quot;</span>, (actual = <a class="code" href="rfile_8c.html#a1dcfb5d7db6ca3365e74df214c5ffdae">rfile_join</a>(strings1, 3)));</div><div class="line"></div><div class="line">free(actual);</div></div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">strings</td><td>Array of char arrays </td></tr>
    <tr><td class="paramname">num_strings</td><td>The number of elems in the strings array</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The path or NULL if there are errors or any of the strings are NULL or the strings array itself is null.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Ruby has some weird behavior here where it sometimes keeps double // and sometimes it doesn't. It doesn't in cases where there is more than one slash in a single one of the input strings. Regardless, the function is for building paths so in that spirit, we don't want those double separators anyways. Soooo, it differs from Ruby in these cases.</dd>
<dd>
The caller must free the return value. </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>The caller must check the return value for NULL.</dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000004">Todo:</a></b></dt><dd><p class="startdd">the no_doubles path will use a bit more memory than it actually needs if some of the double // are removed. </p>
<p class="enddd">Clean this up... </p>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="rfile_8c_source.html#l00356">356</a> of file <a class="el" href="rfile_8c_source.html">rfile.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;{</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <span class="keywordflow">if</span> (rary == NULL) { <span class="keywordflow">return</span> NULL; }</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <span class="keywordtype">int</span> i = 0;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="keywordtype">int</span> j = 0;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <span class="comment">/* Check if any of the rstrings are null */</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; rary-&gt;qty; ++i) {</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordflow">if</span> (rstring_array_get(rary, i) == NULL) { <span class="keywordflow">return</span> NULL; }</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  }</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  rstring* path = NULL;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  rstring* sep = NULL;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  sep = <a class="code" href="rstring_8c.html#af5be360e4bfbee194994cd2ddc3a6823">rstring_new</a>(RFILE_SEPARATOR_STR);</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  path = rstring_array_join(rary, sep);</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <a class="code" href="rstring_8c.html#adc92beb556cd031893d12de377ab1b48">rstring_free</a>(sep);</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <span class="comment">/* If it&#39;s empty, there are no doubles. */</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="rstring_8c.html#a48e81cf18a8972237e862c8ac8c160f7">rstring_length</a>(path) == 0) {</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">return</span> path;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  }</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <span class="comment">/* Remove doubles of file sep. */</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <span class="keywordtype">char</span>* no_doubles = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>) * ((<a class="code" href="rstring_8c.html#a48e81cf18a8972237e862c8ac8c160f7">rstring_length</a>(path) + 1)));</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="keywordflow">if</span> (no_doubles == NULL) { <span class="keywordflow">return</span> NULL; }</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  j = 0;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  no_doubles[j++] = <a class="code" href="rstring_8c.html#a7162fcaec08cf423ad11dfecc279499e">rstring_char_at</a>(path, 0);</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="keywordflow">for</span> (i = 1; i &lt; <a class="code" href="rstring_8c.html#a48e81cf18a8972237e862c8ac8c160f7">rstring_length</a>(path); ++i) {</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    c = <a class="code" href="rstring_8c.html#a7162fcaec08cf423ad11dfecc279499e">rstring_char_at</a>(path, i);</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="keywordflow">if</span> (c != RFILE_SEPARATOR || <a class="code" href="rstring_8c.html#a7162fcaec08cf423ad11dfecc279499e">rstring_char_at</a>(path, i - 1) != RFILE_SEPARATOR) {</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      no_doubles[j++] = c;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    }</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  }</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  no_doubles[j] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  <a class="code" href="rstring_8c.html#adc92beb556cd031893d12de377ab1b48">rstring_free</a>(path);</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  path = <a class="code" href="rstring_8c.html#af5be360e4bfbee194994cd2ddc3a6823">rstring_new</a>(no_doubles);</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <span class="keywordflow">if</span> (path == NULL) { <span class="keywordflow">return</span> NULL; }</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  free(no_doubles);</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  <span class="keywordflow">return</span> path;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;}</div><div class="ttc" id="rstring_8c_html_a7162fcaec08cf423ad11dfecc279499e"><div class="ttname"><a href="rstring_8c.html#a7162fcaec08cf423ad11dfecc279499e">rstring_char_at</a></div><div class="ttdeci">int rstring_char_at(const rstring *rstr, int idx)</div><div class="ttdoc">Return the char at given position. </div><div class="ttdef"><b>Definition:</b> <a href="rstring_8c_source.html#l00290">rstring.c:290</a></div></div>
<div class="ttc" id="rstring_8c_html_af5be360e4bfbee194994cd2ddc3a6823"><div class="ttname"><a href="rstring_8c.html#af5be360e4bfbee194994cd2ddc3a6823">rstring_new</a></div><div class="ttdeci">rstring * rstring_new(const char *cstr)</div><div class="ttdoc">Make a new rstring from c string. </div><div class="ttdef"><b>Definition:</b> <a href="rstring_8c_source.html#l00028">rstring.c:28</a></div></div>
<div class="ttc" id="rstring_8c_html_adc92beb556cd031893d12de377ab1b48"><div class="ttname"><a href="rstring_8c.html#adc92beb556cd031893d12de377ab1b48">rstring_free</a></div><div class="ttdeci">int rstring_free(rstring *rstr)</div><div class="ttdoc">Free the rstring. </div><div class="ttdef"><b>Definition:</b> <a href="rstring_8c_source.html#l00066">rstring.c:66</a></div></div>
<div class="ttc" id="rstring_8c_html_a48e81cf18a8972237e862c8ac8c160f7"><div class="ttname"><a href="rstring_8c.html#a48e81cf18a8972237e862c8ac8c160f7">rstring_length</a></div><div class="ttdeci">int rstring_length(const rstring *rstr)</div><div class="ttdoc">Returns the length of the rstring. </div><div class="ttdef"><b>Definition:</b> <a href="rstring_8c_source.html#l00267">rstring.c:267</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
